<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>3D Ghost Character</title>
    <style>
        body { 
            margin: 0; 
            overflow: hidden;
            background: #0d0d1f;
        }
        #info {
            position: absolute;
            top: 10px;
            left: 10px;
            color: white;
            font-family: Arial;
        }
    </style>
</head>
<body>
    <div id="info">Loading...</div>
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/mrdoob/three.js@r128/examples/js/loaders/GLTFLoader.js"></script>
    <script src="js/procedural-ghost.js"></script>
    <script>
        // Basic Three.js ghost
        let scene, camera, renderer, ghost;
        let time = 0;
        
        function init() {
            // Create scene
            scene = new THREE.Scene();
            
            // Create camera
            camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
            camera.position.z = 5;
            
            // Create renderer
            try {
                renderer = new THREE.WebGLRenderer({ antialias: true });
                renderer.setSize(window.innerWidth, window.innerHeight);
                renderer.setClearColor(0x0d0d1f);
                document.body.appendChild(renderer.domElement);
            } catch (error) {
                document.getElementById('info').textContent = 'WebGL Error: ' + error.message;
                return;
            }
            
            // Create procedural ghost
            ghost = createProceduralGhost(scene);
            scene.add(ghost);
            
            // Try to load GLB model as well
            const loader = new THREE.GLTFLoader();
            loader.load('assets/characters/Ghost/Mesh.glb', 
                (gltf) => {
                    // If GLB loads successfully, replace procedural ghost
                    console.log('GLB loaded successfully, replacing procedural ghost');
                    scene.remove(ghost);
                    ghost = gltf.scene;
                    ghost.scale.set(3, 3, 3);
                    
                    // Apply ghost material
                    ghost.traverse((child) => {
                        if (child.isMesh) {
                            child.material = new THREE.MeshPhongMaterial({
                                color: 0xf0f0ff,
                                emissive: 0x404080,
                                emissiveIntensity: 0.2,
                                transparent: true,
                                opacity: 0.9
                            });
                        }
                    });
                    
                    scene.add(ghost);
                    document.getElementById('info').textContent = 'GLB Ghost loaded! Click to interact.';
                },
                (progress) => {
                    // Progress
                    if (progress.total > 0) {
                        const percent = (progress.loaded / progress.total * 100).toFixed(0);
                        console.log(`Loading GLB... ${percent}%`);
                    }
                },
                (error) => {
                    // Error - keep the procedural ghost
                    console.log('GLB failed to load, using procedural ghost:', error);
                    document.getElementById('info').textContent = 'Procedural ghost ready! Click to interact.';
                }
            );
            
            // Add lights
            const light = new THREE.DirectionalLight(0xffffff, 1);
            light.position.set(1, 1, 1);
            scene.add(light);
            
            const ambientLight = new THREE.AmbientLight(0x404040);
            scene.add(ambientLight);
            
            // Update info
            document.getElementById('info').textContent = 'Ghost manifested! Click to interact.';
            
            // Add click handler
            document.addEventListener('click', () => {
                document.getElementById('info').textContent = 'Boo! I am a ghost!';
                setTimeout(() => {
                    document.getElementById('info').textContent = 'Ghost manifested! Click to interact.';
                }, 2000);
            });
            
            // Handle resize
            window.addEventListener('resize', onWindowResize);
            
            // Start animation
            animate();
        }
        
        function animate() {
            requestAnimationFrame(animate);
            
            time += 0.01;
            
            // Animate ghost
            if (ghost) {
                // Check if it's procedural ghost or GLB
                if (ghost.userData && ghost.userData.body) {
                    // Procedural ghost animation
                    animateProceduralGhost(ghost, time);
                } else {
                    // Simple animation for GLB or fallback
                    ghost.position.y = Math.sin(time * 2) * 0.3;
                    ghost.rotation.y += 0.005;
                    ghost.scale.x = 1 + Math.sin(time * 3) * 0.05;
                    ghost.scale.z = 1 + Math.sin(time * 3) * 0.05;
                }
            }
            
            renderer.render(scene, camera);
        }
        
        function onWindowResize() {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        }
        
        // Initialize
        init();
    </script>
</body>
</html>